(function(f){function p(t){function s(){}s.prototype=t||this;return new s()}var g={};g.settings={};g.Error={toString:function(){return"RecurlyJS Error: "+this.message}};g.raiseError=function(s){var t=p(g.Error);t.message=s;throw t};g.config=function(s){f.extend(true,g.settings,s);if(!s.baseURL){switch(g.settings.environment){case"sandbox":g.settings.baseURL="https://api-sandbox.recurly.com/jsonp/";break;case"production":g.settings.baseURL="https://api-production.recurly.com/jsonp/";break;default:g.raiseError("environment not configured (sandbox or production)");break}var t=g.settings.subdomain||g.raiseError("company subdomain not configured");g.settings.baseURL+=t+"/"}};function o(t,s){if(t==1){return s.substr(0,s.length-1)}return""+t+" "+s}(g.Cost=function(s){this._cents=s||0}).prototype={toString:function(){return g.formatCurrency(this.dollars())},cents:function(s){if(s===undefined){return this._cents}return new Cost(s)},dollars:function(s){if(s===undefined){return this._cents/100}return new g.Cost(s*100)},mult:function(s){return new g.Cost(this._cents*s)},add:function(s){if(s.cents){s=s.cents()}return new g.Cost(this._cents+s)},sub:function(s){if(s.cents){s=s.cents()}return new g.Cost(this._cents-s)}};g.Cost.FREE=new g.Cost(0);(g.TimePeriod=function(t,s){this.length=t;this.unit=s}).prototype={toString:function(){return""+o(this.length,this.unit)},toDate:function(){var s=new Date();switch(this.unit){case"month":s.setMonth(s.getMonth()+this.length);break;case"day":s.setDay(s.getDay()+this.length);break}return s},clone:function(){return new g.TimePeriod(this.length,this.unit)}};(g.RecurringCost=function(t,s){this.cost=t;this.interval=s}).prototype={toString:function(){return""+this.cost+" every "+this.interval},clone:function(){return new g.TimePeriod(this.length,this.unit)}};g.RecurringCost.FREE=new g.RecurringCost(0,null);(g.RecurringCostStage=function(s,t){this.recurringCost=s;this.duration=t}).prototype={toString:function(){this.recurringCost.toString()+" for "+this.duration.toString()}};g.locale={};g.locale.errors={emptyField:"Required field",missingFullAddress:"Please enter your full address.",invalidEmail:"Invalid",invalidCC:"Invalid",invalidCVV:"Invalid",invalidCoupon:"Invalid",cardDeclined:"Transaction declined",acceptTOS:"Please accept the Terms of Service."};g.locale.currencies={};g.locale.currency={format:"%u%n",separator:".",delimiter:",",precision:2};function m(s,t){var v=g.locale.currencies[s]=p(g.locale.currency);for(var u in t){v[u]=t[u]}}m("USD",{symbol:"$"});m("AUD",{symbol:"$"});m("CAD",{symbol:"$"});m("EUR",{symbol:"\u20ac"});m("GBP",{symbol:"\u00a3"});m("CZK",{symbol:"\u004b"});m("DKK",{symbol:"\u6b72"});m("HUF",{symbol:"Ft"});m("JPY",{symbol:"\u00a5"});m("NOK",{symbol:"kr"});m("NZD",{symbol:"$"});m("PLN",{symbol:"\u007a"});m("SGD",{symbol:"$"});m("SEK",{symbol:"kr"});m("CHF",{symbol:"Fr"});m("ZAR",{symbol:"R"});g.settings.locale=g.locale;g.detectCardType=function(s){s=s.replace(/\D/g,"");var u=[{name:"visa",prefixes:[4]},{name:"mastercard",prefixes:[51,52,53,54,55]},{name:"american_express",prefixes:[34,37]},{name:"discover",prefixes:[6011,62,64,65]},{name:"diners_club",prefixes:[305,36,38]},{name:"carte_blanche",prefixes:[300,301,302,303,304,305]},{name:"jcb",prefixes:[35]},{name:"enroute",prefixes:[2014,2149]},{name:"solo",prefixes:[6334,6767]},{name:"switch",prefixes:[4903,4905,4911,4936,564182,633110,6333,6759]},{name:"maestro",prefixes:[5018,5020,5038,6304,6759,6761]},{name:"visa",prefixes:[417500,4917,4913,4508,4844]},{name:"laser",prefixes:[6304,6706,6771,6709]}];for(var v=0;v<u.length;v++){for(var t=0;t<u[v].prefixes.length;t++){if(new RegExp("^"+u[v].prefixes[t].toString()).test(s)){return u[v].name}}}};g.formatCurrency=function(v,z){if(v<0){v=-v;var u=true}else{var u=false}z=z||g.settings.currency||g.raiseError("currency not configured");var y=g.locale.currency;var t=g.locale.currencies[z];var x=v.toFixed(t.precision);if(y.separator!="."){x=x.replace(/\./g,y.separator)}function s(B){var A=new RegExp("(-?[0-9]+)([0-9]{3})");while(A.test(B)){B=B.replace(A,"$1"+y.delimiter+"$2")}return B}x=s(x);var w=y.format;w=w.replace(/%u/g,t.symbol);w=w.replace(/%n/g,x);x=w;if(u){x="-"+x}return x};var j=["AT","BE","BG","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"];g.isCountryInEU=function(s){return f.inArray(s,j)!==-1};g.isVATNumberApplicable=function(t,s){if(!g.settings.VATPercent){return false}if(!g.settings.country){g.raiseError("you must configure a country for VAT to work")}if(!g.isCountryInEU(g.settings.country)){g.raiseError("you cannot charge VAT outside of the EU")}if(!g.isCountryInEU(t)){return false}return true};g.isVATChargeApplicable=function(t,u){if(!g.isVATNumberApplicable(t)){return false}var s=g.settings.country;return(s==t||!u)};g.flattenErrors=function(z,t){var s=[];var w=["base","account_id"];var t=t||"";if(typeof z=="string"||typeof z=="number"||typeof z=="boolean"){if(f.inArray(w,t)){return[z]}return[""+t+" "+z]}for(var v in z){if(z.hasOwnProperty(v)){t=(parseInt(v).toString()==v)?t:v;var y=g.flattenErrors(z[v],t);for(var x=0,u=y.length;x<u;++x){s.push(y[x])}}}return s};g.replaceVars=function(w,u){for(var t in u){if(u.hasOwnProperty(t)){var s=encodeURIComponent(u[t]);w=w.replace(new RegExp("\\{"+t+"\\}","g"),s)}}return w};g.post=function(s,w,t){var u=f("<form />").hide();u.attr("action",s).attr("method","POST").attr("enctype",t?"application/x-www-form-urlencoded":"multipart/form-data");function v(y,B,A){var x=(A.length>0?(A+"["+y+"]"):y);if(typeof B==="object"){for(var z in B){if(B.hasOwnProperty(z)){v(z,B[z],x)}}}else{f('<input type="hidden" />').attr({name:x,value:B}).appendTo(u)}}v("",w,"");f("body").append(u);u.submit()};(g.isValidCC=function(z){var t=z.val();if(/[^0-9-]+/.test(t)){return false}var x=0,w=0,s=false;t=t.replace(/\D/g,"");for(var y=t.length-1;y>=0;y--){var u=t.charAt(y);var w=parseInt(u,10);if(s){if((w*=2)>9){w-=9}}x+=w;s=!s}return(x%10)==0}).defaultErrorKey="invalidCC";(g.isValidEmail=function(t){var s=t.val();return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(s)}).defaultErrorKey="invalidEmail";function b(s){return/^[0-9]+$/.test(s)}(g.isValidCVV=function(t){var s=t.val();return(s.length==3||s.length==4)&&b(s)}).defaultErrorKey="invalidCVV";(g.isNotEmpty=function(t){var s=t.val();return !!s}).defaultErrorKey="emptyField";(g.isChecked=function(s){return s.is(":checked")}).defaultErrorKey="acceptTOS";g.Plan={create:p,fromJSON:function(v){var w=this.create();w.name=v.name;w.code=v.plan_code;w.cost=new g.Cost(v.unit_amount_in_cents);w.displayQuantity=v.display_quantity;w.interval=new g.TimePeriod(v.plan_interval_length,v.plan_interval_unit);if(v.trial_interval_length){w.trial=new g.TimePeriod(v.trial_interval_length,v.trial_interval_unit)}if(v.setup_fee_in_cents){w.setupFee=new g.Cost(v.setup_fee_in_cents)}w.addOns=[];if(v.add_ons){for(var t=v.add_ons.length,u=0;u<t;++u){var s=v.add_ons[u];w.addOns.push(g.AddOn.fromJSON(s))}}return w},get:function(s,t){f.ajax({url:g.settings.baseURL+"plans/"+s,dataType:"jsonp",jsonp:"callback",timeout:10000,success:function(u){var v=g.Plan.fromJSON(u);t(v)}})},createSubscription:function(){var t=p(g.Subscription);t.plan=p(this);t.plan.quantity=1;t.addOns=[];return t}};g.AddOn={fromJSON:function(t){var s=p(g.AddOn);s.name=t.name;s.code=t.add_on_code;s.cost=new g.Cost(t.default_unit_amount_in_cents);s.displayQuantity=t.display_quantity;return s},toJSON:function(){return{name:this.name,add_on_code:this.code,default_unit_amount_in_cents:this.default_unit_amount_in_cents}}};g.Account={create:p,toJSON:function(){return{first_name:this.firstName,last_name:this.lastName,account_code:this.code,email:this.email}}};g.BillingInfo={create:p,toJSON:function(){return{first_name:this.firstName,last_name:this.lastName,month:this.expires.getMonth()+1,year:this.expires.getFullYear(),number:this.number,verification_value:this.cvv,address1:this.address1,address2:this.address2,city:this.city,state:this.state,zip:this.zip,country:this.country}},save:function(s){var t={billing_info:this.toJSON(),signature:s.signature};f.ajax({url:g.settings.baseURL+"accounts/"+s.accountCode+"/billing_info/update",data:t,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(u){if(u.success&&s.success){s.success(u.success)}else{if(u.errors&&s.error){s.error(g.flattenErrors(u.errors))}}},error:function(){if(s.error){s.error(["Unknown error processing transaction. Please try again later."])}},complete:s.complete||f.noop})}};g.Subscription={create:p,plan:g.Plan,addOns:[],calculateTotals:function(){var v={stages:{}};v.plan=this.plan.cost.mult(this.plan.quantity);v.allAddOns=new g.Cost(0);v.addOns={};for(var t=this.addOns.length,u=0;u<t;++u){var s=this.addOns[u],y=s.cost.mult(s.quantity);v.addOns[s.code]=y;v.allAddOns=v.allAddOns.add(y)}v.stages.recurring=v.plan.add(v.allAddOns);v.stages.now=v.plan.add(v.allAddOns);if(this.plan.trial){v.stages.now=g.Cost.FREE}if(this.plan.setupFee){v.stages.now=v.stages.now.add(this.plan.setupFee)}if(this.coupon){var w=v.stages.now;var x=v.stages.now.discount(this.coupon);v.coupon=x.sub(w);v.stages.now=x}if(this.billingInfo&&g.isVATChargeApplicable(this.billingInfo.country,this.billingInfo.vatNumber)){v.vat=v.stages.now.mult((g.settings.VATPercent/100));v.stages.now=v.stages.now.add(v.vat)}return v},redeemAddOn:function(t){var s=t.createRedemption();this.addOns.push(s);return s},removeAddOn:function(v){for(var t=this.addOns,s=t.length,u=0;u<s;++u){if(t[u].code==v){return t.splice(u,1)}}},findAddOnByCode:function(u){for(var s=this.addOns.length,t=0;t<s;++t){if(this.addOns[t].code==u){return this.addOns[t]}}return false},toJSON:function(){var w={plan_code:this.plan.code,quantity:this.plan.quantity,coupon_code:this.coupon?this.coupon.code:undefined,add_ons:[]};for(var v=0,u=this.addOns.length,t=w.add_ons,s=this.addOns;v<u;++v){t.push({add_on_code:s[v].code,quantity:s[v].quantity})}return w},save:function(s){var t={subscription:this.toJSON(),account:this.account.toJSON(),billing_info:this.billingInfo.toJSON()};f.ajax({url:g.settings.baseURL+"subscribe",data:t,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(u){if(u.success&&s.success){s.success(u.success)}else{if(u.errors&&s.error){var v=u.errors.error_code;delete u.errors.error_code;s.error(g.flattenErrors(u.errors),v)}}},error:function(){if(s.error){s.error(["Unknown error processing transaction. Please try again later."])}},complete:s.complete})}};g.AddOn.createRedemption=function(t){var s=p(this);s.quantity=t||1;return s};g.Coupon={fromJSON:function(s){var t=p(g.Coupon);if(s.discount_in_cents){t.discountCost=new g.Cost(-s.discount_in_cents)}else{if(s.discount_percent){t.discountRatio=s.discount_percent/100}}t.description=s.description;return t},toJSON:function(){}};g.Cost.prototype.discount=function(s){if(s.discountCost){return this.add(s.discountCost)}var t=this.sub(this.mult(s.discountRatio));if(t.cents()<0){return g.Cost.FREE}return t};g.Subscription.getCoupon=function(u,s,t){if(!g.settings.baseURL){g.raiseError("Company subdomain not configured")}return f.ajax({url:g.settings.baseURL+"plans/"+this.plan.code+"/coupons/"+u,dataType:"jsonp",jsonp:"callback",timeout:10000,success:function(w){var v=g.Coupon.fromJSON(w);v.code=u;if(w.valid){s(v)}else{t()}},error:function(){t()}})};g.Transaction={toJSON:function(){return{currency:this.currency,amount_in_cents:this.cost.cents()}},create:p,save:function(s){var t={transaction:this.toJSON(),account:this.account?this.account.toJSON():undefined,billing_info:this.billingInfo.toJSON(),signature:s.signature};f.ajax({url:g.settings.baseURL+"transactions/create",data:t,dataType:"jsonp",jsonp:"callback",timeout:60000,success:function(u){if(u.success&&s.success){s.success(u.success)}else{if(u.errors&&s.error){s.error(g.flattenErrors(u.errors))}}},error:function(){if(s.error){s.error(["Unknown error processing transaction. Please try again later."])}},complete:s.complete||f.noop})}};g.UserError={};function n(s,t){var u=p(g.UserError);u.validation=s;u.element=t;throw u}function r(w){try{w()}catch(v){if(!v.validation){throw v}var x=v.element;var u=g.locale.errors[v.validation.errorKey];var t=v.validation.validator;var s=f('<div class="error">');s.text(u);s.appendTo(x.parent());x.addClass("invalid");x.bind("change keyup",function(){if(t(x)){x.removeClass("invalid");s.remove();x.unbind()}});x.focus()}}function l(u,x,t){var z=u.find(x+" input");if(z.length==0){z=u.find(x+" select")}if(z.length==0){return undefined}var y=z.val();for(var w=2,s;s=arguments[w];++w){if(!s.validator(z)){n(s,z)}}return y}function c(t,s){return{validator:t,errorKey:s||t.defaultErrorKey}}function a(s){var t=s.find(".server_errors");t.removeClass("any").addClass("none");t.empty()}function k(t,x){var v=t.find(".server_errors");a(t);var s=x.length;if(s){v.removeClass("none").addClass("any");for(var w=0;w<s;++w){var u=f('<div class="error">');u.text(x[w]);v.append(u)}}}function i(s,t){s.delegate(".placeholder","click",function(){var u=f(this);var v=f(this).parent();v.find("input").focus()});s.delegate("input","change keyup",function(){var v=f(this);var u=f(this).parent();if(v.val().length>0){u.find(".placeholder").hide()}else{u.find(".placeholder").show()}});s.delegate("input","focus",function(){f(this).parent().addClass("focus")});s.delegate("input","blur",function(){f(this).parent().removeClass("focus")});s.delegate("input","keydown",function(u){if(u.keyCode>=48&&u.keyCode<=90){f(this).parent().find(".placeholder").hide()}})}function d(H,G){if(g.settings.country){var w=H.find(".country option[value="+g.settings.country+"]");if(w.length){w.attr("selected",true).change()}}if(G.distinguishContactFromBillingInfo){var F=H.find(".contact_info .first_name input");var y=H.find(".contact_info .last_name input");var A=F.val();var C=y.val();H.find(".contact_info .first_name input").change(function(){var I=H.find(".billing_info .first_name input");if(I.val()==A){I.val(f(this).val()).change()}A=F.val()});H.find(".contact_info .last_name input").change(function(){var I=H.find(".billing_info .last_name input");if(I.val()==C){I.val(f(this).val()).change()}C=y.val()})}else{H.find(".billing_info .first_name, .billing_info .last_name").remove()}var u=new Date();var E=u.getFullYear();var D=u.getMonth();var x=H.find(".year select");var s=H.find(".month select");for(var z=E;z<=E+10;++z){var t=f('<option name="'+z+'">'+z+"</option>");t.appendTo(x)}function B(){if(x.val()==E){s.find('option[value="'+D+'"]');var I=false;s.find("option").each(function(){if(f(this).val()<=D){f(this).attr("disabled",true)}else{f(this).removeAttr("disabled");if(!I){I=true;f(this).attr("selected",true)}}})}else{s.find("option").removeAttr("disabled")}}B();x.change(B);if(G.addressRequirement=="none"){H.find(".address").remove()}else{if(G.addressRequirement=="zip"){H.find(".address").addClass("only_zip");H.find(".address1, .address2, .city, .state").remove();if(!g.settings.VATPercent){H.find(".country").remove()}}else{if(G.addressRequirement=="zipstreet"){H.find(".address").addClass("only_zipstreet");H.find(".city, .state").remove();if(!g.settings.VATPercent){H.find(".country").remove()}}else{if(G.addressRequirement=="full"){H.find(".address").addClass("full")}}}}var v=H.find(".accepted_cards");H.find(".card_number input").bind("change keyup",function(){var I=g.detectCardType(f(this).val());if(I){v.find(".card").each(function(){f(this).toggleClass("match",f(this).hasClass(I));f(this).toggleClass("no_match",!f(this).hasClass(I))})}else{v.find(".card").removeClass("match no_match")}})}function h(s,u,t){u.firstName=l(s,".contact_info .first_name",c(g.isNotEmpty));u.lastName=l(s,".contact_info .last_name",c(g.isNotEmpty));u.email=l(s,".email",c(g.isNotEmpty),c(g.isValidEmail));u.code=t}function e(s,u){u.firstName=l(s,".billing_info .first_name",c(g.isNotEmpty));u.lastName=l(s,".billing_info .last_name",c(g.isNotEmpty));u.number=l(s,".card_number",c(g.isNotEmpty),c(g.isValidCC));u.cvv=l(s,".cvv",c(g.isNotEmpty),c(g.isValidCVV));var t=new Date(0);t.setMonth(l(s,".month")-1);t.setFullYear(l(s,".year"));u.expires=t;u.address1=l(s,".address1",c(g.isNotEmpty));u.address2=l(s,".address2");u.city=l(s,".city",c(g.isNotEmpty));u.state=l(s,".state",c(g.isNotEmpty));u.zip=l(s,".zip",c(g.isNotEmpty));u.country=l(s,".country",c(function(w){return w.val()!="-"},"emptyField"))}function q(s){l(s,".accept_tos",c(g.isChecked))}g.buildBillingInfoUpdateForm=function(t){var u={addressRequirement:"full"};t=f.extend({},u,t);t.distinguishContactFromBillingInfo=true;if(!t.accountCode){g.raiseError("accountCode missing")}if(!t.signature){g.raiseError("signature missing")}var v=g.BillingInfo.create();var s=f(g.updateBillingInfoFormHTML);s.find(".billing_info").html(g.billingInfoFieldsHTML);i(s,t);d(s,t);s.submit(function(w){w.preventDefault();a(s);s.find(".error").remove();s.find(".invalid").removeClass("invalid");r(function(){e(s,v);s.addClass("submitting");s.find("button.submit").attr("disabled",true).text("Please Wait");v.save({signature:t.signature,accountCode:t.accountCode,success:function(x){if(t.afterUpdate){t.afterUpdate(x)}if(t.successURL){var y=t.successURL;g.post(y,x,true)}},error:function(x){if(!t.onError||!t.onError(x)){k(s,x)}},complete:function(){s.removeClass("submitting");s.find("button.submit").removeAttr("disabled").text("Update")}})})});if(t.beforeInject){t.beforeInject(s.get(0))}f(function(){var w=f(t.target);w.html(s);if(t.afterInject){t.afterInject(s.get(0))}})};g.buildTransactionForm=function(t){var w={addressRequirement:"full",distinguishContactFromBillingInfo:true,collectContactInfo:true};t=f.extend(p(g.settings),w,t);if(!t.collectContactInfo&&!t.accountCode){g.raiseError("collectContactInfo is false, but no accountCode provided")}if(!t.signature){g.raiseError("signature missing")}var y=g.BillingInfo.create(),v=g.Account.create(),x=g.Transaction.create();x.account=v;x.billingInfo=y;x.currency=t.currency;x.cost=new g.Cost(t.amountInCents);var s=f(g.oneTimeTransactionFormHTML);s.find(".billing_info").html(g.billingInfoFieldsHTML);if(t.collectContactInfo){s.find(".contact_info").html(g.contactInfoFieldsHTML)}else{s.find(".contact_info").remove()}if(t.termsOfServiceURL){var u=s.find(".accept_tos").html(g.termsOfServiceHTML);u.find("a").attr("href",t.termsOfServiceURL)}else{s.find(".accept_tos").remove()}i(s,t);d(s,t);s.submit(function(z){z.preventDefault();a(s);s.find(".error").remove();s.find(".invalid").removeClass("invalid");r(function(){h(s,v,t.accountCode);e(s,y);q(s);s.addClass("submitting");s.find("button.submit").attr("disabled",true).text("Please Wait");x.save({signature:t.signature,accountCode:t.accountCode,success:function(A){if(t.afterPay){t.afterPay(A)}if(t.successURL){var B=t.successURL;g.post(B,A,true)}},error:function(A){if(!t.onError||!t.onError(A)){k(s,A)}},complete:function(){s.removeClass("submitting");s.find("button.submit").removeAttr("disabled").text("Pay")}})})});if(t.beforeInject){t.beforeInject(s.get(0))}f(function(){var z=f(t.target);z.html(s);if(t.afterInject){t.afterInject(s.get(0))}})};g.buildSubscriptionForm=function(t){var w={enableAddOns:true,enableCoupons:true,addressRequirement:"full",distinguishContactFromBillingInfo:false};t=f.extend(p(g.settings),w,t);var s=f(g.subscribeFormHTML);s.find(".contact_info").html(g.contactInfoFieldsHTML);s.find(".billing_info").html(g.billingInfoFieldsHTML);if(t.termsOfServiceURL){var v=s.find(".accept_tos").html(g.termsOfServiceHTML);v.find("a").attr("href",t.termsOfServiceURL)}else{s.find(".accept_tos").remove()}i(s,t);if(t.planCode){g.Plan.get(t.planCode,u)}else{if(t.plan){u(t.plan)}}function u(x){if(t.filterPlan){x=t.filterPlan(x)||x}var M=x.createSubscription(),y=g.Account.create(),F=g.BillingInfo.create();M.account=y;M.billingInfo=F;if(t.filterSubscription){M=t.filterSubscription(M)||M}d(s,t,F);if(!x.displayQuantity){s.find(".plan .quantity").remove()}if(x.setupFee){s.find(".subscription").addClass("with_setup_fee");s.find(".plan .setup_fee .cost").text(""+x.setupFee)}else{s.find(".plan .setup_fee").remove()}if(x.trial){s.find(".subscription").addClass("with_trial");s.find(".plan .free_trial").text("First "+x.trial+" free")}else{s.find(".plan .free_trial").remove()}function D(){var P=M.calculateTotals();s.find(".plan .recurring_cost .cost").text(""+P.plan);s.find(".due_now .cost").text(""+P.stages.now);s.find(".coupon .discount").text(""+(P.coupon||""));s.find(".vat .cost").text(""+(P.vat||""));s.find(".add_ons .add_on").each(function(){var Q=f(this).data("add_on");if(f(this).hasClass("selected")){var R=P.addOns[Q.code];f(this).find(".cost").text("+ "+R)}else{f(this).find(".cost").text("+ "+Q.cost)}})}s.find(".plan .quantity input").bind("change keyup",function(){M.plan.quantity=parseInt(f(this).val(),10)||1;D()});s.find(".plan .name").text(x.name);s.find(".plan .recurring_cost .cost").text(""+x.cost);s.find(".plan .recurring_cost .interval").text("every "+x.interval);var B=s.find(".add_ons");if(t.enableAddOns){var J=x.addOns.length;if(J){B.removeClass("none").addClass("any");for(var K=0;K<J;++K){var G=x.addOns[K];var L="add_on add_on_"+G.code+(K%2?" even":" odd");if(K==0){L+=" first"}if(K==J-1){L+=" last"}var A=f('<div class="'+L+'"><div class="name">'+G.name+'</div><div class="field quantity"><div class="placeholder">Qty</div><input type="text"></div><div class="cost"/></div>');if(!G.displayQuantity){A.find(".quantity").remove()}A.data("add_on",G);A.appendTo(B)}B.delegate(".add_ons .quantity input","change keyup",function(S){var P=f(this).closest(".add_on");var R=P.data("add_on");var Q=parseInt(f(this).val(),10)||1;M.findAddOnByCode(R.code).quantity=Q;D()});B.bind("selectstart",function(P){if(f(P.target).is(".add_on")){P.preventDefault()}});B.delegate(".add_ons .add_on","click",function(T){if(f(T.target).closest(".quantity").length){return}var R=!f(this).hasClass("selected");f(this).toggleClass("selected",R);var S=f(this).data("add_on");if(R){var P=M.redeemAddOn(S);var Q=f(this).find(".quantity input");P.quantity=parseInt(Q.val(),10)||1;Q.focus()}else{M.removeAddOn(S.code)}D()})}}else{B.remove()}var E=s.find(".coupon");var I=null;function N(){var P=E.find("input").val();if(P==I){return}I=P;if(!P){E.removeClass("invalid").removeClass("valid");E.find(".description").text("");M.coupon=undefined;D();return}E.addClass("checking");M.getCoupon(P,function(Q){E.removeClass("checking");M.coupon=Q;E.removeClass("invalid").addClass("valid");E.find(".description").text(Q.description);D()},function(){M.coupon=undefined;E.removeClass("checking");E.removeClass("valid").addClass("invalid");E.find(".description").text("Not Found");D()})}if(t.enableCoupons){E.find("input").bind("keyup change",function(P){});E.find("input").keypress(function(P){if(P.charCode==13){P.preventDefault();N()}});E.find(".check").click(function(){N()});E.find("input").blur(function(){E.find(".check").click()})}else{E.remove()}var z=s.find(".vat");var O=s.find(".vat_number");var H=O.find("input");z.find(".title").text("VAT at "+g.settings.VATPercent+"%");function C(){var Q=s.find(".country select").val();var S=g.isVATNumberApplicable(Q);O.toggleClass("applicable",S);O.toggleClass("inapplicable",!S);var R=H.val();var P=g.isVATChargeApplicable(Q,R);z.toggleClass("applicable",P);z.toggleClass("inapplicable",!P)}s.find(".country select").change(function(){F.country=f(this).val();D();C()}).change();H.bind("keyup change",function(){F.vatNumber=f(this).val();D();C()});s.submit(function(P){P.preventDefault();a(s);s.find(".error").remove();s.find(".invalid").removeClass("invalid");r(function(){h(s,y,t.accountCode);e(s,F);q(s);s.addClass("submitting");s.find("button.submit").attr("disabled",true).text("Please Wait");M.save({success:function(Q){if(t.afterSubscribe){t.afterSubscribe(Q)}if(t.successURL){var R=t.successURL;g.post(R,Q,true)}},error:function(Q){if(!t.onError||!t.onError(Q)){k(s,Q)}},complete:function(){s.removeClass("submitting");s.find("button.submit").removeAttr("disabled").text("Subscribe")}})})});D();if(t.beforeInject){t.beforeInject(s.get(0))}f(function(){var P=f(t.target);P.html(s);if(t.afterInject){t.afterInject(s.get(0))}})}};g.contactInfoFieldsHTML='<div class="title">Contact Info</div><div class="full_name"><div class="field first_name"><div class="placeholder">First Name </div><input type="text"/></div><div class="field last_name"><div class="placeholder">Last Name </div><input type="text"/></div></div><div class="field email"><div class="placeholder">Email </div><input type="text"/></div>';g.billingInfoFieldsHTML='<div class="title">Billing Info</div><div class="accepted_cards"><div class="card american_express">American Express</div><div class="card discover">Discover</div><div class="card mastercard">MasterCard </div><div class="card visa">Visa</div></div><div class="credit_card"><div class="field first_name"><div class="placeholder">First Name </div><input type="text"/></div><div class="field last_name"><div class="placeholder">Last Name </div><input type="text"/></div><div class="card_cvv"><div class="field card_number"><div class="placeholder">Credit Card Number  </div><input type="text"/></div><div class="field cvv"><div class="placeholder">CVV </div><input type="text"/></div><!-- :number, :maxlength => 22, :class => \'required creditcard\', :placeholder => \'Credit Card Number\'--></div><div class="field expires"><div class="title">Expires </div><div class="month"><select><option value="1">01 - January</option><option value="2">02 - February</option><option value="3">03 - March</option><option value="4">04 - April</option><option value="5">05 - May</option><option value="6">06 - June</option><option value="7">07 - July</option><option value="8">08 - August</option><option value="9">09 - September</option><option value="10">10 - October</option><option value="11">11 - November</option><option value="12">12 - December</option><!-- = render :partial => \'months\' --></select></div><div class="year"><select></select></div></div></div><div class="address"><div class="field address1"><div class="placeholder">Address</div><input type="text"/></div><div class="field address2"><div class="placeholder">Apt/Suite</div><input type="text"/></div><div class="field city"><div class="placeholder">City</div><input type="text"/></div><div class="state_zip"><div class="field state"><div class="placeholder">State/Province</div><input type="text"/></div><div class="field zip"><div class="placeholder">Zip/Postal</div><input type="text"/></div></div><div class="field country"><!-- label Country --><select><option value="-">Select Country</option><option value="-">-------------- </option><option value="AF">Afghanistan</option><option value="AL">Albania</option><option value="DZ">Algeria</option><option value="AS">American Samoa</option><option value="AD">Andorra</option><option value="AO">Angola</option><option value="AI">Anguilla</option><option value="AQ">Antarctica</option><option value="AG">Antigua and Barbuda</option><option value="AR">Argentina</option><option value="AM">Armenia</option><option value="AW">Aruba</option><option value="AC">Ascension(Island</option><option value="AU">Australia</option><option value="AT">Austria</option><option value="AZ">Azerbaijan</option><option value="BS">Bahamas</option><option value="BH">Bahrain</option><option value="BD">Bangladesh</option><option value="BB">Barbados</option><option value="BY">Belarus</option><option value="BE">Belgium</option><option value="BZ">Belize</option><option value="BJ">Benin</option><option value="BM">Bermuda</option><option value="BT">Bhutan</option><option value="BO">Bolivia</option><option value="BA">Bosnia and Herzegovina</option><option value="BW">Botswana</option><option value="BV">Bouvet Island</option><option value="BR">Brazil</option><option value="BQ">British Antarctic Territory</option><option value="IO">British Indian Ocean Territory</option><option value="VG">British Virgin Islands</option><option value="BN">Brunei</option><option value="BG">Bulgaria</option><option value="BF">Burkina Faso</option><option value="BI">Burundi</option><option value="KH">Cambodia</option><option value="CM">Cameroon</option><option value="CA">Canada</option><option value="IC">Canary Islands</option><option value="CT">Canton and Enderbury Islands</option><option value="CV">Cape Verde</option><option value="KY">Cayman Islands</option><option value="CF">Central African Republic</option><option value="EA">Ceuta and Melilla</option><option value="TD">Chad</option><option value="CL">Chile</option><option value="CN">China</option><option value="CX">Christmas Island</option><option value="CP">Clipperton Island</option><option value="CC">Cocos [Keeling] Islands</option><option value="CO">Colombia</option><option value="KM">Comoros</option><option value="CD">Congo [DRC]</option><option value="CG">Congo [Republic]</option><option value="CK">Cook Islands</option><option value="CR">Costa Rica</option><option value="HR">Croatia</option><option value="CU">Cuba</option><option value="CY">Cyprus</option><option value="CZ">Czech Republic</option><option value="DK">Denmark</option><option value="DG">Diego Garcia</option><option value="DJ">Djibouti</option><option value="DM">Dominica</option><option value="DO">Dominican Republic</option><option value="NQ">Dronning Maud Land</option><option value="DD">East Germany</option><option value="TL">East Timor</option><option value="EC">Ecuador</option><option value="EG">Egypt</option><option value="SV">El Salvador</option><option value="GQ">Equatorial Guinea</option><option value="ER">Eritrea</option><option value="EE">Estonia</option><option value="ET">Ethiopia</option><option value="EU">European Union</option><option value="FK">Falkland Islands [Islas Malvinas]</option><option value="FO">Faroe Islands</option><option value="FJ">Fiji</option><option value="FI">Finland</option><option value="FR">France</option><option value="GF">French Guiana</option><option value="PF">French Polynesia</option><option value="TF">French Southern Territories</option><option value="FQ">French Southern and Antarctic Territories</option><option value="GA">Gabon</option><option value="GM">Gambia</option><option value="GE">Georgia</option><option value="DE">Germany</option><option value="GH">Ghana</option><option value="GI">Gibraltar</option><option value="GR">Greece</option><option value="GL">Greenland</option><option value="GD">Grenada</option><option value="GP">Guadeloupe</option><option value="GU">Guam</option><option value="GT">Guatemala</option><option value="GG">Guernsey</option><option value="GN">Guinea</option><option value="GW">Guinea-Bissau</option><option value="GY">Guyana</option><option value="HT">Haiti</option><option value="HM">Heard Island and McDonald Islands</option><option value="HN">Honduras</option><option value="HK">Hong Kong</option><option value="HU">Hungary</option><option value="IS">Iceland</option><option value="IN">India</option><option value="ID">Indonesia</option><option value="IR">Iran</option><option value="IQ">Iraq</option><option value="IE">Ireland</option><option value="IM">Isle of Man</option><option value="IL">Israel</option><option value="IT">Italy</option><option value="CI">Ivory Coast</option><option value="JM">Jamaica</option><option value="JP">Japan</option><option value="JE">Jersey</option><option value="JT">Johnston Island</option><option value="JO">Jordan</option><option value="KZ">Kazakhstan</option><option value="KE">Kenya</option><option value="KI">Kiribati</option><option value="KW">Kuwait</option><option value="KG">Kyrgyzstan</option><option value="LA">Laos</option><option value="LV">Latvia</option><option value="LB">Lebanon</option><option value="LS">Lesotho</option><option value="LR">Liberia</option><option value="LY">Libya</option><option value="LI">Liechtenstein</option><option value="LT">Lithuania</option><option value="LU">Luxembourg</option><option value="MO">Macau</option><option value="MK">Macedonia [FYROM]</option><option value="MG">Madagascar</option><option value="MW">Malawi</option><option value="MY">Malaysia</option><option value="MV">Maldives</option><option value="ML">Mali</option><option value="MT">Malta</option><option value="MH">Marshall Islands</option><option value="MQ">Martinique</option><option value="MR">Mauritania</option><option value="MU">Mauritius</option><option value="YT">Mayotte</option><option value="FX">Metropolitan France</option><option value="MX">Mexico</option><option value="FM">Micronesia</option><option value="MI">Midway Islands</option><option value="MD">Moldova</option><option value="MC">Monaco</option><option value="MN">Mongolia</option><option value="ME">Montenegro</option><option value="MS">Montserrat</option><option value="MA">Morocco</option><option value="MZ">Mozambique</option><option value="MM">Myanmar [Burma]</option><option value="NA">Namibia</option><option value="NR">Nauru</option><option value="NP">Nepal</option><option value="NL">Netherlands</option><option value="AN">Netherlands Antilles</option><option value="NT">Neutral Zone</option><option value="NC">New Caledonia</option><option value="NZ">New Zealand</option><option value="NI">Nicaragua</option><option value="NE">Niger</option><option value="NG">Nigeria</option><option value="NU">Niue</option><option value="NF">Norfolk Island</option><option value="KP">North Korea</option><option value="VD">North Vietnam</option><option value="MP">Northern Mariana Islands</option><option value="NO">Norway</option><option value="OM">Oman</option><option value="QO">Outlying Oceania</option><option value="PC">Pacific Islands Trust Territory</option><option value="PK">Pakistan</option><option value="PW">Palau</option><option value="PS">Palestinian Territories</option><option value="PA">Panama</option><option value="PZ">Panama Canal Zone</option><option value="PG">Papua New Guinea</option><option value="PY">Paraguay</option><option value="YD">People\'s Democratic Republic of Yemen</option><option value="PE">Peru</option><option value="PH">Philippines</option><option value="PN">Pitcairn Islands</option><option value="PL">Poland</option><option value="PT">Portugal</option><option value="PR">Puerto Rico</option><option value="QA">Qatar</option><option value="RO">Romania</option><option value="RU">Russia</option><option value="RW">Rwanda</option><option value="RE">R\u00e9union</option><option value="BL">Saint Barth\u00e9lemy</option><option value="SH">Saint Helena</option><option value="KN">Saint Kitts and Nevis</option><option value="LC">Saint Lucia</option><option value="MF">Saint Martin</option><option value="PM">Saint Pierre and Miquelon</option><option value="VC">Saint Vincent and the Grenadines</option><option value="WS">Samoa</option><option value="SM">San Marino</option><option value="SA">Saudi Arabia</option><option value="SN">Senegal</option><option value="RS">Serbia</option><option value="CS">Serbia and Montenegro</option><option value="SC">Seychelles</option><option value="SL">Sierra Leone</option><option value="SG">Singapore</option><option value="SK">Slovakia</option><option value="SI">Slovenia</option><option value="SB">Solomon Islands</option><option value="SO">Somalia</option><option value="ZA">South Africa</option><option value="GS">South Georgia and the South Sandwich Islands</option><option value="KR">South Korea</option><option value="ES">Spain</option><option value="LK">Sri Lanka</option><option value="SD">Sudan</option><option value="SR">Suriname</option><option value="SJ">Svalbard and Jan Mayen</option><option value="SZ">Swaziland</option><option value="SE">Sweden</option><option value="CH">Switzerland</option><option value="SY">Syria</option><option value="ST">S\u00e3o Tom\u00e9 and Pr\u00edncipe</option><option value="TW">Taiwan</option><option value="TJ">Tajikistan</option><option value="TZ">Tanzania</option><option value="TH">Thailand</option><option value="TG">Togo</option><option value="TK">Tokelau</option><option value="TO">Tonga</option><option value="TT">Trinidad and Tobago</option><option value="TA">Tristan da Cunha</option><option value="TN">Tunisia</option><option value="TR">Turkey</option><option value="TM">Turkmenistan</option><option value="TC">Turks and Caicos Islands</option><option value="TV">Tuvalu</option><option value="UM">U.S. Minor Outlying Islands</option><option value="PU">U.S. Miscellaneous Pacific Islands</option><option value="VI">U.S. Virgin Islands</option><option value="UG">Uganda</option><option value="UA">Ukraine</option><option value="SU">Union(of Soviet Socialist Republics</option><option value="AE">United Arab Emirates</option><option value="GB">United Kingdom</option><option value="US">United States</option><option value="UY">Uruguay</option><option value="UZ">Uzbekistan</option><option value="VU">Vanuatu</option><option value="VA">Vatican City</option><option value="VE">Venezuela</option><option value="VN">Vietnam</option><option value="WK">Wake Island</option><option value="WF">Wallis and Futuna</option><option value="EH">Western Sahara</option><option value="YE">Yemen</option><option value="ZM">Zambia</option><option value="ZW">Zimbabwe</option><option value="AX">\u00c5land Islands</option></select></div></div><div class="field vat_number"><div class="placeholder">VAT Number</div><input type="text"/></div>';g.subscribeFormHTML='<form class="recurly subscribe"><div class="subscription"><div class="plan"><div class="name"></div><div class="field quantity"><div class="placeholder">Qty</div><input type="text"/></div><div class="recurring_cost"><div class="cost"></div><div class="interval"></div></div><div class="free_trial"></div><div class="setup_fee"><div class="title">Setup Fee</div><div class="cost"></div></div></div><div class="add_ons none"></div><div class="coupon"><div class="coupon_code field"><div class="placeholder">Coupon Code</div><input type="text" class="coupon_code"/></div><div class="check"></div><div class="description"></div><div class="discount"></div></div><div class="vat"><div class="title">VAT</div><div class="cost"></div></div></div><div class="due_now"><div class="title">Order Total</div><div class="cost"></div></div><div class="server_errors none"></div><div class="contact_info"></div><div class="billing_info"></div><div class="accept_tos"></div><div class="footer"><button type="submit" class="submit">Subscribe</button></div></form>';g.updateBillingInfoFormHTML='<form class="recurly update_billing_info"><div class="server_errors none"></div><div class="billing_info"></div><div class="footer"><button type="submit" class="submit">Update</button></div></form>';g.oneTimeTransactionFormHTML='<form class="recurly update_billing_info"><div class="server_errors none"></div><div class="contact_info"></div><div class="billing_info"></div><div class="accept_tos"></div><div class="footer"><button type="submit" class="submit">Pay</button></div></form>';g.termsOfServiceHTML='<input id="tos_check" type="checkbox"/><label id="accept_tos" for="tos_check">I accept the <a target="_blank" class="tos_link">Terms of Service</a></label>';window.Recurly=g}(jQuery));